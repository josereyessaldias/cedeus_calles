<h5>Revistas ISI</h5>

<table>
	<tr>
		<th rowspan="2" class="vertical">Periodo</th>
		<th rowspan="2">Cluster</th>
		<th rowspan="2">Autores</th>
		<th rowspan="2">DOI</th>
		<th rowspan="2">Título</th>
		<th rowspan="2">Revista</th>
		<th rowspan="2">Volumen</th>
		<th rowspan="2">Páginas</th>
		<th rowspan="2">Año</th>
		<th colspan="4" style="text-align: center">Participation</th>
		<th colspan="7" style="text-align: center">Funding</th>
		<th rowspan="2">Respaldo</th>

	</tr>
	<tr>
		<th class="vertical" style="max-width: 22px">Researcher</th>
		<th class="vertical" style="max-width: 22px">Postdoc</th>
		<th class="vertical" style="max-width: 22px">Undergrad</th>
		<th class="vertical" style="max-width: 22px">Grad</th>

		<th class="vertical" style="max-width: 22px">Fondap</th>
		<th class="vertical" style="max-width: 22px">Fondecyt</th>
		<th class="vertical" style="max-width: 22px">Fondef</th>
		<th class="vertical" style="max-width: 22px">Basal</th>
		<th class="vertical" style="max-width: 22px">ICM</th>
		<th class="vertical" style="max-width: 22px">Other</th>
		<th class="vertical">Specify</th>
	</tr>

	<% @products.each do |product| %>
		<% @clust = [] %>
		<% @person = [] %>

		<% if product.tipo == "revista_isi" %>
			
			<% product.persons.each do |person| %>

				<% person.clusters.each do |cluster| %>	
					<% if cluster.name != "Sin Cluster" %>
						<% @clust << cluster.name %>
					<% end %>
				<% end %>

				<% @par = [] %>
				<% @par << person.cedeusname %>
				<% t = product.person_product.where(person_id: person.id).first.contact_before_type_cast %>
				<% @par << t if t > 0 %>
				<% @par << "," %>
				<% @person << @par %>
			<% end %>

			<tr>
				<td><strong><%= product.registro %></strong></td>
				<td>
					<% @clust.uniq.each do |i| %>
						<%= i %>/ 
					<% end %>
				</td>
				<td style="width:100px"><strong>
					<% @person.each do |i| %>
						<%= i[0] %> 
						<% if i[1].is_a? Integer %>
							<sup><%= i[1] %></sup>
						<% else %>
							<%= i[1] %>
						<% end %>
						<%= i[2] %>
					<% end %></strong>
				</td>
				<td style="max-width:70px;word-wrap: break-word"><%= product.doi %></td>
				<td style="width:350px;"><strong><%= product.titulo %></strong></td>
				<td style="max-width: 100px"><i><%= product.revista %></i></td>
				<td><%= product.volume %></td>
				<td><%= product.pages %></td>
				<td><%= product.year %></td>
				<td><%= boolean01(product.partresearchers) %></td>
				<td><%= boolean01(product.partpostdoc) %></td>
				<td><%= boolean01(product.partundergrad) %></td>
				<td><%= boolean01(product.partgrad) %></td>
				<td><%= product.fundfondap %></td>
				<td><%= product.fundfondecyt %></td>
				<td><%= product.fundfondef %></td>
				<td><%= product.fundbasal %></td>
				<td><%= product.fundicm %></td>
				<td><%= product.fundother %></td>
				<td><div style="overflow: scroll; max-width: 70px; max-height: 80px;"><%= product.fundspecify %></div></td>
				<td style="max-width: 30px">
					<% product.respaldos.each_with_index do |respaldo,i| %>
						<%= link_to "Respaldo #{i+1}", asset_path(respaldo.file), :target => '_blank' %>
					<% end %>
				</td>

				<td><%= link_to 'editar', edit_product_path(product.id, :tipo => product.tipo) %> 
					<%= link_to 'borrar', product_path(product), method: :delete %></td>

			</tr>
		<% end %>
	<% end %>

</table>
<br>

