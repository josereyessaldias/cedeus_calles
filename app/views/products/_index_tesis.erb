<h5>Tesis de Estudiantes</h5>

<table>
	<tr>
		<th rowspan="2" class="vertical">Periodo</th>
		<th rowspan="2">Research Line</th>
		<th rowspan="2">Etapa</th>
		<th rowspan="2">Estudiante</th>
		<th rowspan="2">RUT</th>
		<th rowspan="2">Género</th>
		<th rowspan="2">Título Tesis</th>
		<th rowspan="2">Grado</th>
		<th rowspan="2">Guía</th>
		<th rowspan="2">Institución</th>
		<th rowspan="2">Fecha incio programa</th>
		<th rowspan="2">Fecha incio tesis</th>
		<th rowspan="2">Fecha finalización tesis</th>
		<th colspan="3" style="text-align: center">Afiliación</th>
		<th rowspan="2">Respaldo</th>
	</tr>
	<tr>
		<th class="vertical" style="max-width: 22px">DTIL</th>
		<th class="vertical" style="max-width: 22px">BRT+</th>
		<th class="vertical" style="max-width: 22px">CEDEUS</th>

	</tr>

	<% @products.each do |product| %>
		<% @clust = [] %>
		<% @persona = [] %>
		<% if product.tipo == "tesis" %>
			
			<% product.person_product.order(:id).each do |person_prod| %>

				<% person_prod.person.clusters.each do |cluster| %>	
					<% if cluster.name != "Sin Cluster" %>
						<% @clust << cluster.name %>
					<% end %>
				<% end %>
				<% @persona << person_prod.person.cedeusname %>
			<% end %>

			<tr>
				<td><strong><%= product.registro %></strong></td>
				<td>
					<% @clust.uniq.each do |i| %>
						<%= i %>/ 
					<% end %>
				</td>
				<td>
					<%= product.etapa_before_type_cast %>
				</td>
				<td><%= product.estudiante %></td>
				<td><%= product.rut %></td>
				<td><%= product.genero %></td>
				<td><%= product.titulo %></td>
				<td><%= product.grado_before_type_cast %></td>
				<td>
					<% @persona.each do |i| %>
						<%= i %>, 
					<% end %>
				</td>
				<td><%= product.institution %></td>
				<td><%= product.year %></td>
				<td><%= product.inicio %></td>
				<td><%= product.termino %></td>
				<td><%= boolean01(product.ditl_check) %></td>
				<td><%= boolean01(product.brt_check) %></td>
				<td><%= boolean01(product.cedeus_check) %></td>
				<td>
					<% product.respaldos.each_with_index do |respaldo,i| %>
						<%= link_to "Respaldo #{i+1}", asset_path(respaldo.file), :target => '_blank' %>
					<% end %>
				</td>

				<td><%= link_to 'editar', edit_product_path(product.id, :tipo => product.tipo) %>
					<%= link_to 'borrar', product_path(product), method: :delete, data: { confirm: "¿Está seguro de borrar la tesis '#{product.titulo}'?"} %></td>

			</tr>
		<% end %>
	<% end %>

</table>
<br>

